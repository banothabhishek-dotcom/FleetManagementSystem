@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}


<head>
    
    <style>
        .btn-custom {
            background-color: #0d6efd;
            color: white;
        }

            .btn-custom:hover {
                background-color: #0b5ed7;
            }

            .btn-custom:hover {
                background-color: #0b5ed7;
            }
    </style>
</head>

<div>
    <nav id="navBar" class="navbar navbar-expand-sm bg-dark navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" asp-controller="Admin" asp-action="AdminPage" id="logo">Fleetora</a>

            <!-- Toggler added here -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent"
                    aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>

        <!-- Collapsible content wrapper -->
        <div class="collapse navbar-collapse" id="navbarContent">
            <div id="Logout" class="me-5">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <button type="button" class="btn btn-dark" data-bs-toggle="popover" data-bs-html="true"
                                data-bs-placement="top" data-bs-content='Logout <i class="fas fa-sign-out fa-lg"></i>'>
                            <i class="fas fa-user fa-lg"></i>
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="text-start mt-3 ms-3">
        <a asp-controller="Admin" asp-action="AdminPage" type="back" class="btn btn-custom">Back</a>
    </div>
    <div class="container">
        <h1 class="text-center">Vehicle List</h1>

        <!-- Add button (triggers modal) -->
        <div class="d-flex justify-content-end align-items-center mb-3">
            <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addVehicleModal">
                <i class="fas fa-plus"></i> Add
            </button>
        </div>

        <!-- Table -->
        <table class="table table-striped table-bordered table-hover">
            <thead class="table-dark text-center">
                <tr>
                    <th scope="col">S.No</th>
                    <th scope="col">Vehicle Number</th>
                    <th scope="col">Type of Vehicle</th>
                    <th scope="col">Actions</th>
                </tr>
            </thead>
            <tbody class="text-center">
                <tr>
                    <th scope="row">1</th>
                    <td>Tata Ace</td>
                    <td>Mini Truck</td>
                    <td>
                        <button class="btn btn-sm btn-primary btn-edit me-2"><i class="fas fa-edit"></i> Edit</button>
                        <button class="btn btn-sm btn-danger delete-btn"><i class="fas fa-trash"></i> Delete</button>
                    </td>
                </tr>
                <tr>
                    <th scope="row">2</th>
                    <td>Ashok Leyland</td>
                    <td>Truck</td>
                    <td>
                        <button class="btn btn-sm btn-primary btn-edit me-2"><i class="fas fa-edit"></i> Edit</button>
                        <button class="btn btn-sm btn-danger delete-btn"><i class="fas fa-trash"></i> Delete</button>
                    </td>
                </tr>
                <tr>
                    <th scope="row">3</th>
                    <td>Volvo</td>
                    <td>Bus</td>
                    <td>
                        <button class="btn btn-sm btn-primary btn-edit me-2"><i class="fas fa-edit"></i> Edit</button>
                        <button class="btn btn-sm btn-danger delete-btn"><i class="fas fa-trash"></i> Delete</button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Add Vehicle Modal -->
    <div class="modal fade" id="addVehicleModal" tabindex="-1" aria-labelledby="addVehicleModalLabel"
         aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">

                <div class="modal-header">
                    <h5 class="modal-title" id="addVehicleModalLabel">Add New Vehicle</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">
                    <form>
                        <div class="mb-3">
                            <label for="vehicleNumber" class="form-label">Vehicle Number</label>
                            <input type="text" class="form-control" id="vehicleNumber"
                                   placeholder="Enter vehicle number">
                        </div>
                        <div class="mb-3">
                            <label for="vehicleType" class="form-label">Type of Vehicle</label>
                            <input type="text" class="form-control" id="vehicleType"
                                   placeholder="Enter type of vehicle">
                        </div>
                    </form>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-success" id="saveVehicle">Save</button>
                </div>

            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">Confirm Delete</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to delete this vehicle?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDelete">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div class="modal fade" id="editModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Vehicle</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editForm">
                        <div class="mb-3">
                            <label class="form-label">Vehicle Number</label>
                            <input type="text" class="form-control" id="editVehicleNumber" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Type of Vehicle</label>
                            <input type="text" class="form-control" id="editVehicleType" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Update</button>
                    </form>
                </div>
            </div>
        </div>
    </div>





    <!--script-->

    <script>
        var popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'))
        var popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
            return new bootstrap.Popover(popoverTriggerEl)
        })


        $(document).ready(function () {
            let serialNo = $("table tbody tr").length;  // count existing rows

            // Save button click
            $("#saveVehicle").click(function () {
                const vehicleNumber = $("#vehicleNumber").val();
                const vehicleType = $("#vehicleType").val();

                if (vehicleNumber && vehicleType) {
                    serialNo++;

                    // Append new row
                    $("table tbody").append(`
                <tr>
                    <th scope="row">${serialNo}</th>
                    <td>${vehicleNumber}</td>
                    <td>${vehicleType}</td>
                    <td>
                        <button class="btn btn-sm btn-primary btn-edit me-2"><i class="fas fa-edit"></i> Edit</button>
                        <button class="btn btn-sm btn-danger delete-btn"><i class="fas fa-trash"></i> Delete</button>
                    </td>
                </tr>
            `);

                    // Clear inputs
                    $("#vehicleNumber").val("");
                    $("#vehicleType").val("");

                    // Close modal
                    $("#addVehicleModal").modal("hide");
                }
            });
        });


        //delete button click

        $(document).ready(function () {
            let rowToDelete;

            // When delete button clicked → open modal
            $(".delete-btn").click(function () {
                rowToDelete = $(this).closest("tr");
                $("#deleteConfirmModal").modal("show");
            });

            // Confirm delete
            $("#confirmDelete").click(function () {
                if (rowToDelete) {
                    rowToDelete.remove();
                    $("#deleteConfirmModal").modal("hide");
                }

                // Renumber S.No
                $("table tbody tr").each(function (index) {
                    $(this).find("td:first, th:first").text(index + 1);
                });
            });
        });


        let rowToEdit; // store selected row

        // Open edit modal with existing row data
        $(document).on("click", ".btn-edit", function () {
            rowToEdit = $(this).closest("tr");
            let number = rowToEdit.find("td:eq(0)").text();
            let type = rowToEdit.find("td:eq(1)").text();

            $("#editVehicleNumber").val(number);
            $("#editVehicleType").val(type);

            $("#editModal").modal("show");
        });

        // Update row after editing
        $("#editForm").submit(function (e) {
            e.preventDefault();

            let number = $("#editVehicleNumber").val();
            let type = $("#editVehicleType").val();

            rowToEdit.find("td:eq(0)").text(number);
            rowToEdit.find("td:eq(1)").text(type);

            $("#editModal").modal("hide");
            alert("Vehicle updated successfully!");
        });





    </script>


</div>

