@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}

<head>
      <style>
        body {
            background-color: #f8f9fa;
        }

        .card {
            margin-top: 20px;
        }

        .btn-custom {
            background-color: #0d6efd;
            color: white;
        }

            .btn-custom:hover {
                background-color: #0b5ed7;
            }

            .btn-custom:hover {
                background-color: #0b5ed7;
            }
    </style>
</head>
<div>
    <nav id="navBar" class="navbar navbar-expand-sm bg-dark navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" asp-controller="Admin" asp-action="AdminPage" id="logo">Fleetora</a>

            <!-- Toggler added here -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent"
                    aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>

        <!-- Collapsible content wrapper -->
        <div class="collapse navbar-collapse" id="navbarContent">
            <div id="Logout" class="me-5">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a href="../login/login.html" type="button" class="btn btn-dark" data-bs-toggle="popover" data-bs-html="true"
                           data-bs-placement="top" data-bs-content='Logout <i class="fas fa-sign-out fa-lg"></i>'>
                            <i class="fas fa-user fa-lg"></i>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="text-start mt-3 ms-3">
        <a asp-controller="Admin" asp-action="AdminPage" type="back" class="btn btn-custom">Back</a>
    </div>

    <div class="container">
        <h2 class="text-center mb-4">Maintenance Tracking</h2>

        <!-- Schedule Maintenance Form -->
        <div class="card">
            <div class="card-header bg-primary text-white">Schedule Maintenance</div>
            <div class="card-body">
                <form id="maintenanceForm">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="vehicleId" class="form-label">Vehicle ID</label>
                            <input type="text" class="form-control" id="vehicleId" required>
                        </div>
                        <div class="col-md-6">
                            <label for="scheduledDate" class="form-label">Scheduled Date</label>
                            <input type="date" class="form-control" id="scheduledDate" required>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="description" class="form-label">Description</label>
                        <textarea class="form-control" id="description" rows="3" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-success">Schedule</button>
                </form>
            </div>
        </div>

        <!-- Maintenance Records Table -->
        <div class="card mt-4">
            <div class="card-header bg-secondary text-white">Maintenance Records</div>
            <div class="card-body">
                <table class="table table-bordered table-striped">
                    <thead>
                        <tr>
                            <th>Maintenance ID</th>
                            <th>Vehicle ID</th>
                            <th>Description</th>
                            <th>Scheduled Date</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="maintenanceTable">
                        <!-- Records will be dynamically inserted here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
            var popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'))
                var popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
                    return new bootstrap.Popover(popoverTriggerEl)
                })

          // Dummy data for demonstration
          const maintenanceRecords = [
            { maintenanceId: 1, vehicleId: 'VH001', description: 'Oil Change', scheduledDate: '2025-09-01', status: 'Scheduled' },
            { maintenanceId: 2, vehicleId: 'VH002', description: 'Brake Inspection', scheduledDate: '2025-09-05', status: 'Completed' }
          ];

          const tableBody = document.getElementById('maintenanceTable');

          function renderTable() {
            tableBody.innerHTML = '';
            maintenanceRecords.forEach(record => {
              const row = `<tr>
                <td>${record.maintenanceId}</td>
                <td>${record.vehicleId}</td>
                <td>${record.description}</td>
                <td>${record.scheduledDate}</td>
                <td>${record.status}</td>
              </tr>`;
              tableBody.innerHTML += row;
            });
          }

          document.getElementById('maintenanceForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const newRecord = {
              maintenanceId: maintenanceRecords.length + 1,
              vehicleId: document.getElementById('vehicleId').value,
              description: document.getElementById('description').value,
              scheduledDate: document.getElementById('scheduledDate').value,
              status: 'Scheduled'
            };
            maintenanceRecords.push(newRecord);
            renderTable();
            this.reset();
          });

        function renderTable() {
            $('#maintenanceTable').empty();
            maintenanceRecords.forEach((record, index) => {
              const isCompleted = record.status === 'Completed';
              const row = `
                <tr>
                  <td>${record.maintenanceId}</td>
                  <td>${record.vehicleId}</td>
                  <td>${record.description}</td>
                  <td>${record.scheduledDate}</td>
                  <td class="status">${record.status}</td>
                  <td>
                    <button
                      class="btn btn-sm ${isCompleted ? 'btn-success' : 'btn-primary'} toggle-status"
                      data-index="${index}"
                      ${isCompleted ? 'disabled' : ''}
                    >
                      ${isCompleted ? 'Completed' : 'Mark Completed'}
                    </button>
                  </td>
                </tr>`;
              $('#maintenanceTable').append(row);
            });
          }

          $(document).on('click', '.toggle-status', function () {
            const index = $(this).data('index');
            const record = maintenanceRecords[index];

            // Only allow if not already completed
            if (record.status !== 'Completed') {
              record.status = 'Completed';
              renderTable();
            }
          });


          renderTable();
    </script>

</div>
